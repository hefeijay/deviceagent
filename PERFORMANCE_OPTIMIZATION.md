# æ€§èƒ½ä¼˜åŒ–è¯´æ˜

## ğŸ¯ é—®é¢˜

**ä¼˜åŒ–å‰**ï¼šæ¯æ¬¡è¯·æ±‚éƒ½é‡å¤æ‰§è¡Œä»¥ä¸‹æ“ä½œ
```
æ¯æ¬¡ API è¯·æ±‚:
  â”œâ”€ åŠ è½½æç¤ºè¯          (æ–‡ä»¶ I/O)
  â”œâ”€ è·å–è®¾å¤‡åˆ—è¡¨        (API è°ƒç”¨)
  â”œâ”€ åˆ›å»º LLM å®ä¾‹       (åˆå§‹åŒ–å¼€é”€)
  â”œâ”€ é…ç½® middleware     (å¯¹è±¡åˆ›å»º)
  â””â”€ åˆ›å»º Agent          âš ï¸ æœ€è€—æ—¶ï¼(~500ms-1s)
```

## âœ… ä¼˜åŒ–æ–¹æ¡ˆ

**ä¼˜åŒ–å**ï¼šåœ¨åº”ç”¨å¯åŠ¨æ—¶é¢„åˆ›å»ºæ‰€æœ‰ Agent
```
åº”ç”¨å¯åŠ¨æ—¶ (ä»…ä¸€æ¬¡):
  â””â”€ agent_manager.initialize()
     â”œâ”€ åˆ›å»º feeder_agent   âœ…
     â”œâ”€ åˆ›å»º camera_agent   âœ…
     â””â”€ åˆ›å»º sensor_agent   âœ…

æ¯æ¬¡ API è¯·æ±‚ (å¿«é€Ÿ):
  â”œâ”€ è·å–è®¾å¤‡åˆ—è¡¨        (ä»éœ€åŠ¨æ€è·å–ï¼Œä¿æŒæ•°æ®æ–°é²œ)
  â””â”€ agent_manager.invoke_xxx()  âš¡ ç›´æ¥ä½¿ç”¨é¢„åˆ›å»ºçš„ Agent
```

## ğŸ“ ä¸»è¦æ”¹åŠ¨

### 1. **æ–°å¢ `graph/agent_manager.py`**
- å•ä¾‹æ¨¡å¼çš„ Agent ç®¡ç†å™¨
- åœ¨å¯åŠ¨æ—¶é¢„åˆ›å»ºæ‰€æœ‰ Agent
- æä¾› `invoke_feeder_agent()` / `invoke_camera_agent()` / `invoke_sensor_agent()` æ–¹æ³•

### 2. **ä¿®æ”¹ `api/app.py`**
```python
# åœ¨ lifespan ä¸­åˆå§‹åŒ–
from graph.agent_manager import agent_manager
agent_manager.initialize()  # â† é¢„åˆ›å»ºæ‰€æœ‰ Agent
```

### 3. **ç®€åŒ– `graph/device_nodes.py`**
**ä¼˜åŒ–å‰ï¼ˆæ¯æ¬¡åˆ›å»ºï¼‰ï¼š**
```python
async def feeder_agent_node(state):
    # ... åŠ è½½æç¤ºè¯ã€å·¥å…·
    agent = create_agent(...)  # â† è€—æ—¶ï¼
    result = await agent.ainvoke(...)
```

**ä¼˜åŒ–åï¼ˆå¤ç”¨é¢„åˆ›å»ºï¼‰ï¼š**
```python
async def feeder_agent_node(state):
    from graph.agent_manager import agent_manager
    result = await agent_manager.invoke_feeder_agent(...)  # âš¡ å¿«é€Ÿï¼
```

## ğŸš€ æ€§èƒ½æå‡

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| **é¦–æ¬¡è¯·æ±‚** | ~2-3s | ~2-3s | æ— å˜åŒ–ï¼ˆå¯åŠ¨æ—¶å·²åˆ›å»ºï¼‰ |
| **åç»­è¯·æ±‚** | ~1.5-2s | ~0.5-1s | **50-70% æå‡** |
| **Agent åˆ›å»º** | æ¯æ¬¡ | ä»…å¯åŠ¨æ—¶ | **Næ¬¡ â†’ 1æ¬¡** |
| **å†…å­˜å ç”¨** | ä½ï¼ˆç¬æ—¶ï¼‰ | ä¸­ï¼ˆå¸¸é©»ï¼‰ | +50MBï¼ˆå¯æ¥å—ï¼‰ |

## ğŸ”„ è®¾è®¡äº®ç‚¹

### **åŠ¨æ€è®¾å¤‡åˆ—è¡¨**
- Agent æœ¬èº«æ˜¯é¢„åˆ›å»ºçš„ï¼ˆsystem_prompt å›ºå®šï¼‰
- è®¾å¤‡åˆ—è¡¨æ¯æ¬¡åŠ¨æ€è·å–å¹¶æ³¨å…¥åˆ°**ç”¨æˆ·æ¶ˆæ¯**ä¸­
- ä¿è¯æ•°æ®æ–°é²œåº¦çš„åŒæ—¶ï¼Œé¿å…é‡å¤åˆ›å»º Agent

### **ä»£ç ç»“æ„æ¸…æ™°**
```
graph/
  â”œâ”€ agent_manager.py      â† ç»Ÿä¸€ç®¡ç†æ‰€æœ‰ Agent
  â”œâ”€ device_nodes.py       â† èŠ‚ç‚¹å‡½æ•°åªè´Ÿè´£è°ƒç”¨ Agent
  â””â”€ builder.py            â† å·¥ä½œæµæ„å»ºï¼ˆå·²æœ‰ï¼‰
```

## ğŸ¯ é€‚ç”¨åœºæ™¯

- âœ… **é«˜å¹¶å‘åœºæ™¯**ï¼šå¤šç”¨æˆ·åŒæ—¶è¯·æ±‚ï¼ŒAgent å¤ç”¨é¿å…é‡å¤åˆ›å»º
- âœ… **é•¿æœŸè¿è¡ŒæœåŠ¡**ï¼šå†…å­˜å¸¸é©»å¯æ¥å—
- âŒ **Serverless/FaaS**ï¼šå†·å¯åŠ¨æ—¶ä»éœ€åˆ›å»ºï¼Œä¼˜åŠ¿ä¸æ˜æ˜¾

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

```bash
# å¯åŠ¨æœåŠ¡ï¼ˆä¼šçœ‹åˆ°é¢„åˆ›å»ºæ—¥å¿—ï¼‰
python server.py

# æ—¥å¿—è¾“å‡º
ğŸ¤– åˆå§‹åŒ–è®¾å¤‡ Agent ç®¡ç†å™¨...
âœ… å–‚é£Ÿæœº Agent åˆ›å»ºå®Œæˆï¼ˆ3 ä¸ªå·¥å…·ï¼‰
âœ… æ‘„åƒå¤´ Agent åˆ›å»ºå®Œæˆï¼ˆ2 ä¸ªå·¥å…·ï¼‰
âœ… ä¼ æ„Ÿå™¨ Agent åˆ›å»ºå®Œæˆï¼ˆ1 ä¸ªå·¥å…·ï¼‰
ğŸ‰ æ‰€æœ‰è®¾å¤‡ Agent é¢„åˆ›å»ºå®Œæˆï¼
âœ… è®¾å¤‡ Agent å·²é¢„åˆ›å»ºå®Œæˆ
âœ… å·¥ä½œæµå·²é¢„æ„å»ºå®Œæˆ

# æµ‹è¯•è¯·æ±‚ï¼ˆå“åº”æ›´å¿«ï¼ï¼‰
curl -X POST http://localhost:8000/api/v1/chat \
  -H "Content-Type: application/json" \
  -d '{"query": "å–‚é£Ÿ2ä»½", "session_id": "test-123"}'
```

## ğŸ”® æœªæ¥ä¼˜åŒ–

1. **å®šæ—¶åˆ·æ–°è®¾å¤‡åˆ—è¡¨**ï¼šå¯é€‰åœ°ç¼“å­˜è®¾å¤‡åˆ—è¡¨ï¼Œæ¯5åˆ†é’Ÿåˆ·æ–°ä¸€æ¬¡
2. **Agent æ± åŒ–**ï¼šä¸ºé«˜å¹¶å‘åœºæ™¯åˆ›å»ºå¤šä¸ª Agent å®ä¾‹
3. **æ‡’åŠ è½½**ï¼šæŒ‰éœ€åˆ›å»º Agentï¼ˆé¦–æ¬¡ä½¿ç”¨æ—¶æ‰åˆ›å»ºï¼‰

---

**æ€»ç»“**ï¼šé€šè¿‡é¢„åˆ›å»º Agentï¼Œåœ¨å¯åŠ¨æ—¶ä»˜å‡ºä¸€æ¬¡æ€§å¼€é”€ï¼Œæ¢å–åç»­è¯·æ±‚çš„æ˜¾è‘—æ€§èƒ½æå‡ã€‚è¿™æ˜¯å…¸å‹çš„"ç©ºé—´æ¢æ—¶é—´"ä¼˜åŒ–ç­–ç•¥ã€‚

